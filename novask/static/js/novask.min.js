var job_id=undefined;var since=0;var progress=0;var resultsLoopTimeout=1000;var setScrollPos=undefined;var pushScrollPos=true;var validateFields=function(){checked=false;query_valid=false;$("input.engine-checkbox").each(function(b){i=$(this);if(i.prop("checked")){checked=true;return false}});if(!checked){btn=$("button#btn-engines");showErrorTooltip(btn,"At least one search engine must be selected");setEventRemoveTooltip(btn,"click")}querybox=$("input#input-query");if(getQuery()!==""){query_valid=true}else{showErrorTooltip(querybox,"Please type some search keywords");setEventRemoveTooltip(querybox,"keypress");setEventRemoveTooltip(querybox,"focus")}return checked&&query_valid};var showErrorTooltip=function(b,c){b=$(b);b.attr("data-original-title",c);b.tooltip("show")};var removeTooltip=function(c,b){c=$(c);c.tooltip("hide");c.attr("data-original-title","");if(b!==undefined){c.off(b)}};var setEventRemoveTooltip=function(b,c){$(b).on(c,function(){removeTooltip(b,c)})};var getEngineStr=function(){engines=[];all=true;$("input.engine-checkbox").each(function(b){i=$(this);if(i.prop("checked")){engines.push(i.attr("name"))}else{all=false}});if(all){return"all"}return engines.join(",")};var setEnginesFromStr=function(b){if(b==="all"){$("input.engine-checkbox").prop("checked",true);return}e=b.split(",");$("input.engine-checkbox").prop("checked",false);for(i in e){$('input.engine-checkbox[name="'+e[i]+'"]').prop("checked",true)}};var getCategory=function(){return $("#btn-category").attr("data-category")};var setCategory=function(b){$("button#btn-category").attr("data-category",b);d=$("#dropdown-category");d.find("a").removeClass("active");d.find('a[data-category="'+b+'"]').addClass("active")};var getQuery=function(){return $("#input-query").val()};var setQuery=function(b){$("#input-query").val(b)};var startStopSearch=function(){if(job_id===undefined){doSearch()}else{stopSearch()}};var doSearch=function(b){if(b===undefined){b=false}if(!validateFields()){return}uiSearchStart();window.job_id=undefined;window.since=0;enginestr=getEngineStr();category=getCategory();query=getQuery();$.post("/api/v1.0/search",{engines:enginestr,query:query,category:category},success=function(f,c,g){job_id=f.uuid;pushState(b);setTimeout(queryResultsLoop,resultsLoopTimeout)})};var stopSearch=function(){uiSearchDone();$.get("/api/v1.0/stopsearch?uuid="+job_id);job_id=undefined;since=-1};var filenamify=function(b){return b.trim().replace(/[^\x00-\x7F]/g,"").replace(/[*?!#"'&()~@=[\]{}]/g,"").replace(/[\s\\/]/g,"_")};var showFunnySearchMsg=function(){messages=["Search may take up to 2 minutes, please wait...","Spinning up the hamster, please wait...","Adding randomly mispeled words into text, please wait...","Attaching beards to dwarves, please wait...","Doing something you don't wanna know about, please wait...","Ensuring gnomes are still short, please wait...","Drinking a glass out of the BitTorrent, please wait...","Getting angry won't make this faster, please wait...","Pay no attention to the man behind the curtain","Go ahead -- hold your breath","We're testing your patience"];$("h1.search-message").text(messages[Math.floor(Math.random()*messages.length)])};var uiSearchStart=function(b){if(b===undefined){b=true}btn=$("button#btn-search");btn.empty();btn.append('Stop <i class="fa fa-stop-circle"></i>');btn.removeClass("btn-outline-success").addClass("btn-danger");showFunnySearchMsg();$("section#search-message").show();$("section#results").hide();$("table#results-table tbody").empty();window.pushScrollPos=false;if(b){NProgress.start()}};var uiSearchDone=function(){btn=$("button#btn-search");btn.empty();btn.append('Search <i class="fa fa-search"></i>');btn.removeClass("btn-danger").addClass("btn-outline-success");$("h1.search-message").text("Search something");NProgress.done();window.pushScrollPos=true;if(setScrollPos!==undefined){$(window).scrollTop(setScrollPos);window.setScrollPos=undefined}};var formatSize=function(b){mults=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];index=0;while(b>1000){b=b/1024;index++}return(Math.round(b*10)/10).toString()+" "+mults[Math.min(index,mults.length-1)]};var sizeToBytes=function(b){s=b.split(" ");n=parseFloat(s[0]);mults=["b","kib","mib","gib","tib","pib","eib","zib","yib"];e=mults.indexOf(s[1].toLowerCase());if(e<=0){return n}return n*Math.pow(1024,e)};var addResult=function(b){if(b.found_at>since){window.since=b.found_at}tr=$("<tr></tr>");dl=$('<td class="dl-td"></td>');a=$('<a target="_blank"></a>');if(b.link.startsWith("magnet")){a.append('<i class="fa fa-magnet"></i>');a.attr("href",b.link)}else{a.append('<i class="fa fa-download"></i>');a.attr("href","/api/v1.0/download/"+filenamify(b.name)+".torrent?url="+encodeURIComponent(b.link)+"&engine="+encodeURIComponent(b.engine_url))}dl.append(a);title=$("<td></td>");if(b.desc_link!==undefined){a=$('<a target="_blank"></a>');a.attr("href",b.desc_link);a.text(b.name);title.append(a)}else{title.text(b.name)}size="<td>"+formatSize(b.size)+"</td>";seeds="<td>"+b.seeds+"</td>";leech="<td>"+b.leech+"</td>";a=$('<a _target="blank"></a>');a.attr("href",b.engine_url);a.text(b.engine_url);source=$("<td></td>").append(a);tr.append(dl).append(title).append(size).append(seeds).append(leech).append(source);$("#results-table").find("tbody").append(tr)};var readResults=function(b){if(b.results.length>0&&!$("section#results").is(":visible")){$("section#results").show();$("section#search-message").hide()}for(r in b.results){addResult(b.results[r])}if(b.finished){window.job_id=undefined}if(b.progress!==progress){progress=b.progress;NProgress.set(progress/100)}$("#results-table").trigger("update")};var queryResultsLoop=function(){$.get("/api/v1.0/results?uuid="+job_id+"&since="+since,success=function(c,b,f){readResults(c);if(job_id!==undefined){setTimeout(queryResultsLoop,resultsLoopTimeout)}else{uiSearchDone();if($("table#results-table tbody").children().length==0&&since!==-1){$("h1.search-message").text("No results")}}})};var sortSizes=function(f,c,j,g,h){f=sizeToBytes(f);c=sizeToBytes(c);return((f<c)?-1:((f>c)?1:0))};var resetSort=function(){$("#results-table").trigger("sorton",[[[3,1],[4,0],[1,0]]])};var resetFilters=function(){t=$("#results-table");t.find("input[data-column]").val("");t.trigger("search",false)};var seedsGT10=function(){t=$("#results-table");t.find("input[data-column='3']").val(">10");t.trigger("search",false)};var leechLT10=function(){t=$("#results-table");t.find("input[data-column='4']").val("<10");t.trigger("search",false)};var queryInName=function(){t=$("#results-table");t.find("input[data-column='1']").val(getQuery());t.trigger("search",false)};var bindWindowScroll=function(){$(window).scroll(function(){scroll=$(window).scrollTop();if(scroll>5){$(".navbar").addClass("navbar-shadow")}else{$(".navbar").removeClass("navbar-shadow")}if(pushScrollPos){prevscroll=history.state.scrollPos;if(Math.abs(scroll-prevscroll)>10){pushScrollPosToState(scroll)}}})};var unbindWindowScroll=function(){$(window).off("scroll")};var getGET=function(){var g=[],f;var b=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var c=0;c<b.length;c++){f=b[c].split("=");g.push(f[0]);g[f[0]]=f[1]}return g};var genGET=function(b){getstr="?";for(arg in b){if(!b.hasOwnProperty(arg)){continue}getstr+=arg+"="+encodeURIComponent(b[arg])+"&"}return getstr.substring(0,getstr.length-1)};var popState=function(b){if(job_id!==undefined){stopSearch()}if(b===null&&location.search!==""){parseArgs()}else{if(b===null){setQuery("");setCategory("all");setEnginesFromStr("all");window.job_id=undefined;window.since=0;uiSearchStart(false);uiSearchDone()}else{setQuery(b.query);setCategory(b.category);setEnginesFromStr(b.engines);window.job_id=b.uuid;window.since=0;window.pushScrollPos=false;window.setScrollPos=b.scrollPos;uiSearchStart();setTimeout(queryResultsLoop,0)}}};window.onpopstate=function(b){popState(b.state)};var pushScrollPosToState=function(b){stateObj=history.state;stateObj.scrollPos=b;history.replaceState(stateObj,document.title,location.toString())};var pushUUIDToState=function(b){stateObj=history.state;stateObj.uuid=b;history.replaceState(stateObj,document.title,location.toString()+"&uuid="+b)};var pushState=function(b){if(b===undefined){b=true}stateObj={uuid:job_id,engines:getEngineStr(),category:getCategory(),query:getQuery(),scrollPos:0};args={q:stateObj.query,uuid:job_id,engines:stateObj.engines,category:stateObj.category};if(!b){history.pushState(stateObj,document.title,location.pathname+genGET(args))}else{history.replaceState(stateObj,document.title,location.pathname+genGET(args))}};var parseArgs=function(){args=getGET();if(args.engines!==undefined){setEnginesFromStr(args.engines)}if(args.category!==undefined){setCategory(args.category)}if(args.q!==undefined){setQuery(decodeURIComponent(args.q))}if(args.uuid!==undefined){window.job_id=args.uuid;window.since=0;uiSearchStart();setTimeout(queryResultsLoop,0)}else{if(args.q!==undefined){doSearch(true)}}};$(document).ready(function(){tooltip_error='<div class="tooltip tooltip-error" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>';$('[data-tooltip="tooltip-error"]').tooltip({container:"body",template:tooltip_error,placement:"bottom"});$("textarea, input").keyup(function(b){if(b.keyCode==13){$(this).trigger("enterKey")}});bindWindowScroll();NProgress.configure({trickleSpeed:1000});NProgress.trickle=function(){NProgress.inc(0.003)}});if(typeof(String.prototype.trim)==="undefined"){String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}};